<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="description" content="Arduino with frontend JS : Connect Arduino input to JS with joystick HID">

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>Arduino with frontend JS</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/DeqingSun/Arduino_HID_frontendJS">View on GitHub</a>

          <h1 id="project_title">Arduino with frontend JS</h1>
          <h2 id="project_tagline">Connect Arduino input to JS with joystick HID</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/DeqingSun/Arduino_HID_frontendJS/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/DeqingSun/Arduino_HID_frontendJS/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h1>
<a id="connect-arduino-to-webpage-with-frontend-javascript-only" class="anchor" href="#connect-arduino-to-webpage-with-frontend-javascript-only" aria-hidden="true"><span class="octicon octicon-link"></span></a>Connect Arduino to Webpage with frontend Javascript only</h1>

<p>Connect Arduino input to JS with joystick HID</p>

<h2>
<a id="why-we-need-it" class="anchor" href="#why-we-need-it" aria-hidden="true"><span class="octicon octicon-link"></span></a>Why we need it</h2>

<p>There are tons of ways to connect physical computing stuff to computer via Processing, NodeJs, etc. However there isn't much tutorial on connecting hardware to webpage without using backend scripts. This projects describes a way to provide one way communication from Arduino to browser without running additional scripts. </p>

<h2>
<a id="pros-and-cons-of-this-method" class="anchor" href="#pros-and-cons-of-this-method" aria-hidden="true"><span class="octicon octicon-link"></span></a>Pros and Cons of this method</h2>

<p>Pros: Simple to deploy. No need to install anything on computer. No need to learn language other than Javascript.</p>

<p>Cons: One way communication only. Works well on Firefox, Buggy on Chrome, Not functional in Safari. </p>

<h2>
<a id="how-this-works" class="anchor" href="#how-this-works" aria-hidden="true"><span class="octicon octicon-link"></span></a>How this works?</h2>

<p>Native <a href="http://www.w3.org/TR/gamepad/">GamePad API</a> supports readonly access to GamePad. This low level API can access buttons, axes of a gamepad. Since axes are in float format within -1~1 and buttons are in boolean format. We can emulate a Gamepad with Arduino and send values by emulating axes and button actions. Then JavaScript in browser can extract values from the emulated gamepad.</p>

<p>As a demo I used Arduino Leonardo (Any ATmega32u4 based board including Micro/Micro Pro should work) because it has native USB support to emulate a gamepad. However, official Arduino IDE did not provide capability to emulate a gamepad. I found a project <a href="http://github.com/NicoHood/HID">Arduino HID Project</a> by Nicohood that did all low level stuff on HID and makes this demo pretty simple.</p>

<p>You can either follow <a href="http://github.com/NicoHood/HID/wiki">NicoHood's tutorial</a> on how to install the library or upload a pre-compiled hex file to Leonardo for a quick test.</p>

<h3>
<a id="write-your-own-code" class="anchor" href="#write-your-own-code" aria-hidden="true"><span class="octicon octicon-link"></span></a>Write your own code</h3>

<p>Make sure you followed the <a href="https://github.com/NicoHood/HID/wiki/Installation">install guide</a> and put HID in hardware folder of your sketch book.</p>

<p>Make sure you chose "Arduino Leonardo HID-Project" in Board:
<img src="https://raw.githubusercontent.com/DeqingSun/Arduino_HID_frontendJS/master/tutorial/HID_library_board.png" alt="Arduino Leonardo HID-Project"></p>

<p>And "Serial + Gamepad HID" in USB Core:
<img src="https://raw.githubusercontent.com/DeqingSun/Arduino_HID_frontendJS/master/tutorial/HID_library_board.png" alt="Serial + Gamepad HID"></p>

<p>Then you can open "sketch_forward_input_JS_gamepad/sketch_forward_input_JS_gamepad.ino" in this repo and upload it to your Leonardo. Also you can modify the code to add your own feature.</p>

<h3>
<a id="upload-hex-file-directly" class="anchor" href="#upload-hex-file-directly" aria-hidden="true"><span class="octicon octicon-link"></span></a>Upload hex file directly</h3>

<p>If you want to skip installing the library and only want to try it. There is a sketch_forward_input_JS_gamepad.cpp.hex to use.</p>

<p>You can check both verbose output so you can copy avrdude command from Arduino.</p>

<p><img src="https://raw.githubusercontent.com/DeqingSun/Arduino_HID_frontendJS/master/tutorial/upload_hex_1.png" alt="verbose output"></p>

<p>Compile and upload any sketch to Leonardo. Find avrdude command in output.</p>

<p><img src="https://raw.githubusercontent.com/DeqingSun/Arduino_HID_frontendJS/master/tutorial/upload_hex_2.png" alt="Avrdude command"></p>

<p>Paste the command into terminal</p>

<p><img src="https://raw.githubusercontent.com/DeqingSun/Arduino_HID_frontendJS/master/tutorial/upload_hex_3.png" alt="Paste command"></p>

<p>Delete original hex file path</p>

<p><img src="https://raw.githubusercontent.com/DeqingSun/Arduino_HID_frontendJS/master/tutorial/upload_hex_4.png" alt="Remove hex"></p>

<p>Drag and drop new hex file into terminal</p>

<p><img src="https://raw.githubusercontent.com/DeqingSun/Arduino_HID_frontendJS/master/tutorial/upload_hex_5.png" alt="new file"></p>

<p>Now you can reset Leonardo and press enter to upload hex file</p>

<p><img src="https://raw.githubusercontent.com/DeqingSun/Arduino_HID_frontendJS/master/tutorial/upload_hex_6.png" alt="upload"></p>

<h2>
<a id="test-gamepad" class="anchor" href="#test-gamepad" aria-hidden="true"><span class="octicon octicon-link"></span></a>Test Gamepad</h2>

<p>Now you should be able to see a functional gamepad. You can use "Game Controller" in control panel if you are using Windows.</p>

<p><img src="https://raw.githubusercontent.com/DeqingSun/Arduino_HID_frontendJS/master/tutorial/working_joystick.png" alt="gamepad"></p>

<h2>
<a id="wiring" class="anchor" href="#wiring" aria-hidden="true"><span class="octicon octicon-link"></span></a>Wiring</h2>

<p>I used a potentiometer to generate a analog value and buttons to generate digital ones. No pull-up resistor is needed because internal ones are enabled. Just connect buttons between IO and Ground.</p>

<p><img src="https://raw.githubusercontent.com/DeqingSun/Arduino_HID_frontendJS/master/test_circuit/Leonardo_test_circuit.jpg" alt="photo"></p>

<p><img src="https://raw.githubusercontent.com/DeqingSun/Arduino_HID_frontendJS/master/test_circuit/Leonardo_test_circuit.png" alt="circuit"></p>

<h2>
<a id="connect-it-with-browser" class="anchor" href="#connect-it-with-browser" aria-hidden="true"><span class="octicon octicon-link"></span></a>Connect it with Browser!</h2>

<p>Firefox is recommended in this step. You can open <a href="http://www.html5rocks.com/en/tutorials/doodles/gamepad/">http://www.html5rocks.com/en/tutorials/doodles/gamepad/</a> to test if gamepad is recognized.</p>

<p><img src="https://raw.githubusercontent.com/DeqingSun/Arduino_HID_frontendJS/master/tutorial/html5rockFirefox.png" alt="rock"></p>

<p>If you want to write your own code, you can refer to simple.html in this repo.</p>

<p><img src="https://raw.githubusercontent.com/DeqingSun/Arduino_HID_frontendJS/master/tutorial/connectFirefox.png" alt="simple"></p>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">Arduino with frontend JS maintained by <a href="https://github.com/DeqingSun">DeqingSun</a></p>
        <p>Published with <a href="https://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    

  </body>
</html>
